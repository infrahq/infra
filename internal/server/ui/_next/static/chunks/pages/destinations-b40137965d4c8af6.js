(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{6870:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/destinations",function(){return n(6517)}])},5686:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5893);function s(e){var t=e.message,n=e.center,s=void 0!==n&&n;return(0,r.jsx)("p",{className:"".concat(s?"mt-2 text-center":"mb-1"," text-xs text-pink-500"),children:t})}},3783:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5893);function s(e){var t=e.type,n=e.value,s=e.placeholder,a=e.handleInputChange,i=e.handleKeyDown,o=e.disabled,c=void 0!==o&&o,l=e.error,u=e.hasDropdownSelection,d=void 0===u||u,f=e.optionType,x=e.options,m=e.handleSelectOption,v=e.selectedItem;return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"relative w-full pr-4 py-3 border-b bg-transparent focus:outline-none focus:ring focus:ring-cyan-600 disabled:opacity-30 ".concat(l?"border-pink-500":"border-gray-800"),children:[(0,r.jsx)("input",{autoFocus:!0,spellCheck:"false",type:t,value:n,className:"block ".concat(d?"":"w-full"," sm:text-2xs bg-transparent focus:outline-none placeholder:italic placeholder:text-gray-400 placeholder:text-2xs"),placeholder:s,onChange:a,onKeyDown:i,disabled:c}),d&&(0,r.jsxs)("div",{className:"absolute inset-y-0 right-2 flex items-center",children:[(0,r.jsx)("label",{htmlFor:f,className:"sr-only",children:f}),(0,r.jsx)("select",{id:f,name:f,onChange:m,value:v,className:"h-full py-0 pl-2 border-transparent bg-transparent text-2xs text-gray-400 focus:outline-none",children:x.map((function(e){return(0,r.jsx)("option",{value:e,children:e},e)}))})]})]})})}},8324:function(e,t,n){"use strict";n.d(t,{o:function(){return r}});var r=function(e){var t;return(null===(t=String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/))||void 0===t?void 0:t.length)>0}},6517:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return F}});var r=n(4051),s=n.n(r),a=n(5893),i=n(8100),o=n(9008),c=n(7294),l=n(9521),u=n(7484),d=n.n(u),f=n(661),x=n(9540),m=n(5140),v=n(5857),h=n(3251),p=n(1399),y=n(8324),b=n(3783),g=n(5686),j=n(6763);function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e,t,n,r,s,a,i){try{var o=e[a](i),c=o.value}catch(l){return void n(l)}o.done?t(c):Promise.resolve(c).then(r,s)}function k(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function i(e){N(a,r,s,i,o,"next",e)}function o(e){N(a,r,s,i,o,"throw",e)}i(void 0)}))}}function S(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e){var t=e.id;if(!t)return null;var n=(0,i.ZP)("/v1/identities/".concat(t.replace("i:","")),{fallbackData:{name:""}}).data;return(0,a.jsx)("p",{className:"text-2xs",children:n.name})}function P(e){var t=e.id,n=(0,i.ZP)("/v1/destinations/".concat(t)).data,r=(0,i.ZP)((function(){return"/v1/grants?resource=".concat(n.name)})).data,o=(0,i.kY)().mutate,l=(0,c.useState)(""),u=l[0],d=l[1],f=(0,c.useState)(""),x=f[0],m=f[1],v=(0,c.useState)(""),h=v[0],p=v[1],w=(0,c.useState)("view"),N=w[0],P=w[1],Z=["view","edit","admin","remove"],D=function(){var e=k(s().mark((function e(t){var r,a,i,c=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=c.length>1&&void 0!==c[1]?c[1]:N,a=c.length>2&&void 0!==c[2]&&c[2],i=c.length>3?c[3]:void 0,o("/v1/grants?resource=".concat(n.name),function(){var e=k(s().mark((function e(o){var c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/v1/grants",{method:"POST",body:JSON.stringify({subject:t,resource:n.name,privilege:r})});case 2:return c=e.sent,e.next=5,c.json();case 5:if(l=e.sent,!a){e.next=9;break}return e.next=9,fetch("/v1/grants/".concat(i),{method:"DELETE"});case 9:return d(""),e.abrupt("return",S((o||[]).filter((function(e){return(null===e||void 0===e?void 0:e.subject)!==t}))).concat([l]));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=k(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,y.o)(u)){e.next=32;break}return m(""),e.prev=2,e.next=5,fetch("/v1/identities?name=".concat(u));case 5:return t=e.sent,e.next=8,t.json();case 8:if(n=e.sent,t.ok){e.next=11;break}throw n;case 11:if(0!==n.length){e.next=24;break}return e.next=14,fetch("/v1/identities",{method:"POST",body:JSON.stringify({name:u})});case 14:return t=e.sent,e.next=17,t.json();case 17:return r=e.sent,e.next=20,D("i:"+r.id);case 20:d(""),P("view"),e.next=25;break;case 24:D("i:"+n[0].id);case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(2),p(e.t0.message||"something went wrong, please try again later.");case 30:e.next=33;break;case 32:m("Invalid email");case 33:case"end":return e.stop()}}),e,null,[[2,27]])})));return function(){return e.apply(this,arguments)}}();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-1 mt-3 ".concat(x?"mb-2":"mb-4"),children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(b.Z,{type:"email",value:u,placeholder:"Email",error:x,optionType:"role",options:Z.filter((function(e){return"remove"!==e})),handleInputChange:function(e){return t=e.target.value,d(t),void m("");var t},handleSelectOption:function(e){return P(e.target.value)},handleKeyDown:function(e){"Enter"===e.key&&u.length>0&&E()},selectedItem:N})}),(0,a.jsxs)("button",{onClick:function(){return E()},disabled:0===u.length,type:"button",className:"flex items-center border border-violet-300 disabled:opacity-30 disabled:transform-none disabled:transition-none cursor-pointer disabled:cursor-default mt-4 mr-auto sm:ml-4 sm:mt-0 rounded-md text-2xs px-3 py-3",children:[(0,a.jsx)(j.Z,{className:"w-3 h-3 mr-1.5"}),(0,a.jsx)("div",{className:"text-violet-100",children:"Share"})]})]}),x&&(0,a.jsx)(g.Z,{message:x}),(null===r||void 0===r?void 0:r.length)>0&&(0,a.jsx)("div",{className:"py-2 max-h-40 overflow-y-auto",children:null===r||void 0===r?void 0:r.sort((function(e,t){return e.subject.localeCompare(t.subject)})).map((function(e){return(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(C,{id:e.subject}),(0,a.jsx)("div",{children:(0,a.jsx)("select",{id:"role",name:"role",className:"w-full pl-3 pr-1 py-2 border-gray-300 focus:outline-none text-2xs text-gray-400 bg-transparent",defaultValue:e.privilege,onChange:function(t){return function(e,t,a){if("remove"!==e)return D(a,e,!0,t);o("/v1/grants?resource=".concat(n.name),function(){var e=k(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/v1/grants/".concat(t),{method:"DELETE"});case 2:return e.abrupt("return",null===n||void 0===n?void 0:n.filter((function(e){return(null===e||void 0===e?void 0:e.id)!==t})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{optimisticData:null===r||void 0===r?void 0:r.filter((function(e){return(null===e||void 0===e?void 0:e.id)!==t}))})}(t.target.value,e.id,e.subject)},children:Z.map((function(e){return(0,a.jsx)("option",{value:e,children:e},e)}))})})]},e.id)}))}),0===(null===r||void 0===r?void 0:r.length)&&(0,a.jsx)("div",{className:"text-2xs text-gray-400 italic w-2/3",children:"*Share access to this cluster by inviting your team and assigning their roles."}),h&&(0,a.jsx)(g.Z,{message:h})]})}var Z=n(5388),D=n(5506);function E(e){var t=e.children,n=e.handleClose,r=e.title,s=e.iconPath;return(0,a.jsxs)("aside",{className:"flex w-full h-full max-w-xs lg:max-w-md ml-20 my-0 flex-col",children:[(0,a.jsxs)("header",{className:"flex flex-start justify-between items-center my-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"border border-violet-300/20 rounded-md flex items-center tracking-tight text-sm px-2 py-2",children:(0,a.jsx)("img",{src:s,className:"w-5 h-5 opacity-50"})}),(0,a.jsx)("h1",{className:"flex flex-row items-center space-x-4 text-2xs",children:r})]}),(0,a.jsx)("button",{type:"button",className:"rounded-md bg-transparents text-gray-400 p-2 -mr-2 hover:text-white focus:outline-none cursor-pointer",onClick:n,children:(0,a.jsx)(D.Z,{className:"h-6 w-6 stroke-1","aria-hidden":"true"})})]}),t]})}function O(e,t,n,r,s,a,i){try{var o=e[a](i),c=o.value}catch(l){return void n(l)}o.done?t(c):Promise.resolve(c).then(r,s)}function I(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function i(e){O(a,r,s,i,o,"next",e)}function o(e){O(a,r,s,i,o,"throw",e)}i(void 0)}))}}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){T(e,t,n[t])}))}return e}function _(e){var t=e.destination,n=e.admin,r=e.setSelectedDestination,o=(0,i.ZP)("/v1/identities/self").data,l=(0,i.ZP)((function(){return"/v1/identities/".concat(null===o||void 0===o?void 0:o.id,"/grants?resource=").concat(t.name)})).data,u=(0,i.kY)().mutate,f=(0,c.useState)(!1),x=f[0],m=f[1];return(0,a.jsxs)("div",{className:"flex-1 flex flex-col space-y-6",children:[(null===l||void 0===l?void 0:l.length)>0&&(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"py-4 text-3xs text-gray-400 border-b border-gray-800 uppercase",children:"Connect"}),(0,a.jsxs)("p",{className:"text-2xs my-4",children:["Connect to this cluster via the ",(0,a.jsx)("a",{target:"_blank",href:"https://infrahq.com/docs/install/install-infra-cli",className:"underline text-violet-200 font-medium",rel:"noreferrer",children:"Infra CLI"})]}),(0,a.jsxs)("pre",{className:"px-4 py-3 rounded-md text-gray-300 bg-gray-900 text-2xs leading-normal",children:["infra login ",window.location.host,(0,a.jsx)("br",{}),"infra use ",t.name,(0,a.jsx)("br",{}),"kubectl get pods"]})]}),n&&(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"py-4 text-3xs text-gray-400 border-b border-gray-800 uppercase",children:"Access"}),(0,a.jsx)(P,{id:t.id})]}),(0,a.jsxs)("section",{children:[(0,a.jsx)("h3",{className:"py-4 text-3xs text-gray-400 border-b border-gray-800 uppercase",children:"Meta"}),(0,a.jsxs)("div",{className:"pt-3 flex flex-col space-y-2",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsx)("div",{className:"text-gray-400 text-2xs w-1/3",children:"ID"}),(0,a.jsx)("div",{className:"text-2xs font-mono",children:t.id})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsx)("div",{className:"text-gray-400 text-2xs w-1/3",children:"Added"}),(0,a.jsx)("div",{className:"text-2xs",children:d()(null===t||void 0===t?void 0:t.created).fromNow()})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsx)("div",{className:"text-gray-400 text-2xs w-1/3",children:"Last Seen"}),(0,a.jsx)("div",{className:"text-2xs",children:d()(null===t||void 0===t?void 0:t.lastSeen).fromNow()})]})]})]}),(0,a.jsxs)("section",{className:"flex-1 flex flex-col items-end justify-end py-6",children:[(0,a.jsx)("button",{type:"button",onClick:function(){return m(!0)},className:"border border-violet-300 rounded-md flex items-center text-2xs px-6 py-3 text-violet-100",children:"Delete"}),(0,a.jsx)(p.Z,{open:x,onCancel:function(){return m(!1)},onSubmit:I(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u("/v1/destinations",function(){var e=I(s().mark((function e(n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/v1/destinations/".concat(t.id),{method:"DELETE"});case 2:return e.abrupt("return",null===n||void 0===n?void 0:n.filter((function(e){return(null===e||void 0===e?void 0:e.id)!==t.id})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m(!1),r(null);case 3:case"end":return e.stop()}}),e)}))),title:"Delete Cluster",message:(0,a.jsxs)(a.Fragment,{children:["Are you sure you want to disconnect ",(0,a.jsxs)("span",{className:"text-white font-bold",children:[null===t||void 0===t?void 0:t.name,"?"]}),(0,a.jsx)("br",{}),"Note: you must also uninstall the Infra Connector from this cluster."]})})]})]})}var L=[{Header:"Name",accessor:"name",Cell:function(e){var t=e.value;return(0,a.jsxs)("div",{className:"flex py-1.5 items-center",children:[(0,a.jsx)("div",{className:"border border-gray-800 flex-none flex items-center justify-center w-7 h-7 mr-3 rounded-md",children:(0,a.jsx)("img",{className:"opacity-25",src:"/row-infrastructure.svg"})}),t]})}},{id:"connected",Header:function(){return(0,a.jsx)("div",{className:"text-right",children:"Connection"})},accessor:"updated",Cell:function(e){var t=e.value,n=new Date-new Date(t)<864e5;return(0,a.jsx)("div",{className:"flex items-center text-gray-400 justify-end",children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-[7px] h-[7px] bg-green-400 rounded-full mr-1.5"}),"Connected"]}):(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-[7px] h-[7px] bg-gray-600 rounded-full mr-1.5"}),"Disconnected"]})})}}];function F(){var e,t=(0,i.ZP)("/v1/destinations"),n=t.data,r=t.error,s=(0,f.A)(),u=s.admin,d=s.loading,x=(0,c.useState)(null),p=x[0],y=x[1],b=(0,l.useTable)({columns:L,data:n||[]}),g=d||!n&&!r;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.default,{children:(0,a.jsx)("title",{children:"Destinations - Infra"})}),g?(0,a.jsx)(m.Z,{}):(0,a.jsxs)("div",{className:"flex-1 flex h-full",children:[(0,a.jsxs)("main",{className:"flex-1 flex flex-col space-y-4",children:[(0,a.jsx)(Z.Z,{header:"Infrastructure",buttonHref:u&&"/destinations/add",buttonLabel:"Infrastructure"}),(null===r||void 0===r?void 0:r.status)?(0,a.jsx)("div",{className:"my-20 text-center font-light text-gray-300 text-sm",children:null===r||void 0===r||null===(e=r.info)||void 0===e?void 0:e.message}):(0,a.jsxs)("div",{children:[(0,a.jsx)(v.Z,A({},b,{getRowProps:function(e){return{onClick:function(){return y(e.original)},style:{cursor:"pointer"}}}})),0===(null===n||void 0===n?void 0:n.length)&&(0,a.jsx)(h.Z,{title:"There is no infrastructure",subtitle:"There is currently no infrastructure connected to Infra",iconPath:"/destinations.svg",buttonHref:u&&"/destinations/add",buttonText:"Infrastructure"})]})]}),p&&(0,a.jsx)(E,{handleClose:function(){return y(null)},title:p.name,iconPath:"/destinations.svg",children:(0,a.jsx)(_,{destination:p,admin:u,setSelectedDestination:y})})]})]})}F.layout=function(e){return(0,a.jsx)(x.Z,{children:e})}}},function(e){e.O(0,[551,608,362,774,888,179],(function(){return t=6870,e(e.s=t);var t}));var t=e.O();_N_E=t}]);