(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{4917:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return t(7271)}])},5876:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});var n=t(5893);function a(e){var r=e.children;return(0,n.jsx)("div",{className:"w-full min-h-full flex flex-col justify-center",children:(0,n.jsxs)("div",{className:"flex flex-col w-full max-w-xs mx-auto justify-center items-center my-8 px-5 pt-8 pb-4 border rounded-lg border-gray-800",children:[(0,n.jsx)("div",{className:"border border-violet-200/25 rounded-full p-2.5 mb-4",children:(0,n.jsx)("img",{className:"w-12 h-12",src:"/infra-color.svg"})}),r]})})}},3701:function(e,r,t){"use strict";t.d(r,{a:function(){return n},p:function(){return a}});var n=[{name:"Okta",kind:"okta",available:!0},{name:"Google",kind:"google"},{name:"Azure Active Directory",kind:"azure-ad"},{name:"GitHub",kind:"github"},{name:"GitLab",kind:"gitlab"},{name:"OpenID",kind:"openid"}];function a(e){return(null===e||void 0===e?void 0:e.endsWith(".okta.com"))?"okta":""}},7271:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return h}});var n=t(4051),a=t.n(n),o=t(5893),i=t(1163),s=t(7294),l=t(8100),c=t(3701),u=t(5876);function d(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function f(e,r,t,n,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void t(c)}s.done?r(l):Promise.resolve(l).then(n,a)}function m(e){return function(){var r=this,t=arguments;return new Promise((function(n,a){var o=e.apply(r,t);function i(e){f(o,n,a,i,s,"next",e)}function s(e){f(o,n,a,i,s,"throw",e)}i(void 0)}))}}function p(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"===typeof e)return d(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return d(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e){var r=e.providers;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"w-full max-w-sm mt-2",children:null===r||void 0===r?void 0:r.map((function(e){return(0,o.jsx)("button",{onClick:function(){return function(e){var r=e.id,t=e.url,n=e.clientID;window.localStorage.setItem("providerID",r);var a=p(Array(10)).map((function(){return(~~(36*Math.random())).toString(36)})).join("");window.localStorage.setItem("state",a);var o=window.location.origin+"/login/callback";window.localStorage.setItem("redirectURL",o),document.location.href="https://".concat(t,"/oauth2/v1/authorize?redirect_uri=").concat(o,"&client_id=").concat(n,"&response_type=code&scope=openid+email+groups+offline_access&state=").concat(a)}(e)},className:"w-full border border-gray-800 hover:to-pink-50 rounded-md p-0.5 my-1.5",children:(0,o.jsx)("div",{className:"flex flex-col items-center justify-center px-4 py-2",children:(0,c.p)(e.url)?(0,o.jsxs)("button",{className:"flex flex-col items-center text-center py-0.5",children:[(0,o.jsx)("img",{className:"h-4",src:"/providers/".concat((0,c.p)(e.url),".svg")}),(null===r||void 0===r?void 0:r.length)>1&&(0,o.jsx)("div",{className:"text-2xs text-gray-300",children:e.url})]}):(0,o.jsx)("p",{className:"font-bold h-4 m-1",children:"Single Sign-On"})})},e.id)}))}),(0,o.jsxs)("div",{className:"w-full mt-4 relative",children:[(0,o.jsx)("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:(0,o.jsx)("div",{className:"w-full border-t border-gray-800"})}),(0,o.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,o.jsx)("span",{className:"px-2 bg-black text-2xs text-gray-300",children:"OR"})})]})]})}function h(){var e=(0,l.ZP)("/v1/providers",{fallbackData:[]}).data,r=(0,l.kY)().mutate,t=(0,i.useRouter)(),n=(0,s.useState)(""),c=n[0],u=n[1],d=(0,s.useState)(""),f=d[0],p=d[1],h=(0,s.useState)(""),v=h[0],b=h[1];function g(){return(g=m(a().mark((function e(n){var o,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.prev=1,e.next=4,fetch("/v1/login",{method:"post",body:JSON.stringify({passwordCredentials:{name:c,password:f}})});case 4:if((o=e.sent).ok){e.next=9;break}return e.next=8,o.json();case 8:throw e.sent;case 9:return e.next=11,o.json();case 11:if(!(i=e.sent).passwordUpdateRequired){e.next=15;break}return t.replace({pathname:"/login/finish",query:{id:i.polymorphicID.replace("i:","")}}),e.abrupt("return");case 15:r("/v1/identities/self",{optimisticData:{name:c}}),t.replace("/"),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),console.error(e.t0),b("Invalid credentials");case 23:return e.abrupt("return",!1);case 24:case"end":return e.stop()}}),e,null,[[1,19]])})))).apply(this,arguments)}return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h1",{className:"text-base leading-snug font-bold",children:"Login to Infra"}),(0,o.jsxs)("h2",{className:"text-xs text-center max-w-[260px] my-3 text-gray-300",children:["Welcome back. Login with your credentials ",e.length>0&&"or via your identity provider."]}),(null===e||void 0===e?void 0:e.length)>0&&(0,o.jsx)(x,{providers:e}),(0,o.jsxs)("form",{onSubmit:function(e){return g.apply(this,arguments)},className:"flex flex-col w-full max-w-sm relative",children:[(0,o.jsxs)("div",{className:"w-full my-2",children:[(0,o.jsx)("label",{htmlFor:"name",className:"text-3xs text-gray-500 uppercase",children:"Username"}),(0,o.jsx)("input",{required:!0,autoFocus:!0,name:"name",placeholder:"enter your username or email",onChange:function(e){u(e.target.value),b("")},className:"w-full bg-transparent border-b border-gray-800 text-2xs px-px py-2 focus:outline-none focus:border-b focus:border-gray-200 placeholder:italic ".concat(v?"border-pink-500/60":"")})]}),(0,o.jsxs)("div",{className:"w-full my-2",children:[(0,o.jsx)("label",{htmlFor:"password",className:"text-3xs text-gray-500 uppercase",children:"Password"}),(0,o.jsx)("input",{required:!0,name:"password",type:"password",placeholder:"enter your password",onChange:function(e){p(e.target.value),b("")},className:"w-full bg-transparent border-b border-gray-800 text-2xs px-px py-2 focus:outline-none focus:border-b focus:ring-gray-200 placeholder:italic ".concat(v?"border-pink-500/60":"")})]}),(0,o.jsx)("button",{disabled:!c||!f,className:"border border-violet-300 hover:border-violet-100 mt-6 mb-2 text-2xs px-4 py-3 rounded-lg disabled:pointer-events-none text-violet-100 disabled:opacity-30",children:"Login"}),v&&(0,o.jsx)("p",{className:"absolute -bottom-3.5 w-full mx-auto text-2xs text-pink-400 text-center",children:v})]})]})}h.layout=function(e){return(0,o.jsx)(u.Z,{children:e})}}},function(e){e.O(0,[774,888,179],(function(){return r=4917,e(e.s=r);var r}));var r=e.O();_N_E=r}]);