(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{3733:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return t(5413)}])},5686:function(e,n,t){"use strict";t.d(n,{Z:function(){return i}});var r=t(5893);function i(e){var n=e.message,t=e.center,i=void 0!==t&&t;return(0,r.jsx)("p",{className:"".concat(i?"mt-2 text-center":"mb-1"," text-xs text-pink-500"),children:n})}},3783:function(e,n,t){"use strict";t.d(n,{Z:function(){return i}});var r=t(5893);function i(e){var n=e.type,t=e.value,i=e.placeholder,s=e.handleInputChange,a=e.handleKeyDown,o=e.disabled,l=void 0!==o&&o,c=e.error,d=e.hasDropdownSelection,u=void 0===d||d,f=e.optionType,x=e.options,m=e.handleSelectOption,h=e.selectedItem;return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"relative w-full pr-4 py-3 border-b bg-transparent focus:outline-none focus:ring focus:ring-cyan-600 disabled:opacity-30 ".concat(c?"border-pink-500":"border-gray-800"),children:[(0,r.jsx)("input",{autoFocus:!0,spellCheck:"false",type:n,value:t,className:"block ".concat(u?"":"w-full"," sm:text-2xs bg-transparent focus:outline-none placeholder:italic placeholder:text-gray-400 placeholder:text-2xs"),placeholder:i,onChange:s,onKeyDown:a,disabled:l}),u&&(0,r.jsxs)("div",{className:"absolute inset-y-0 right-2 flex items-center",children:[(0,r.jsx)("label",{htmlFor:f,className:"sr-only",children:f}),(0,r.jsx)("select",{id:f,name:f,onChange:m,value:h,className:"h-full py-0 pl-2 border-transparent bg-transparent text-2xs text-gray-400 focus:outline-none",children:x.map((function(e){return(0,r.jsx)("option",{value:e,children:e},e)}))})]})]})})}},9540:function(e,n,t){"use strict";t.d(n,{Z:function(){return m}});var r=t(4051),i=t.n(r),s=t(5893),a=t(1664),o=t(1163),l=t(8100),c=t(661);function d(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function u(e,n,t,r,i,s,a){try{var o=e[s](a),l=o.value}catch(c){return void t(c)}o.done?n(l):Promise.resolve(l).then(r,i)}function f(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var s=e.apply(n,t);function a(e){u(s,r,i,a,o,"next",e)}function o(e){u(s,r,i,a,o,"throw",e)}a(void 0)}))}}function x(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"===typeof e)return d(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return d(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){var n,t=e.children,r=(0,o.useRouter)(),d=(0,l.ZP)("/v1/identities/self").data,u=(0,l.ZP)("/v1/version").data,m=(0,c.A)(),h=m.admin,v=m.loading,p=(0,l.kY)().mutate;if(v)return null;function g(){return(g=f(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fetch("/v1/logout",{method:"POST"}),e.next=3,p("/v1/identities/self",f(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)}))));case 3:r.replace("/login");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=[{name:"Infrastructure",href:"/destinations",icon:"/destinations.svg"},{name:"Providers",href:"/providers",icon:"/providers.svg",admin:!0}],b=[{name:"Settings",href:"/settings",admin:!0}],j=!0,N=!1,w=void 0;try{for(var k,S=x(y).concat(x(b))[Symbol.iterator]();!(j=(k=S.next()).done);j=!0){var P=k.value;if(r.asPath.startsWith(P.href)&&P.admin&&!h)return r.replace("/"),null}}catch(Z){N=!0,w=Z}finally{try{j||null==S.return||S.return()}finally{if(N)throw w}}return(0,s.jsxs)("div",{className:"flex h-full relative",children:[(0,s.jsxs)("nav",{className:"flex-none flex flex-col w-56 inset-y-0 overflow-hidden",children:[(0,s.jsx)("div",{className:"flex-shrink-0 flex items-center mt-6 mb-10 lg:my-18 px-5 select-none",children:(0,s.jsx)(a.default,{href:"/",children:(0,s.jsx)("a",{children:(0,s.jsx)("img",{className:"h-[15px]",src:"infra.svg",alt:"Infra"})})})}),(0,s.jsx)("div",{className:"flex-1 space-y-1 px-5 select-none",children:y.map((function(e){return(0,s.jsx)(a.default,{href:e.href,children:(0,s.jsxs)("a",{href:e.href,className:"\n                  ".concat(r.asPath.startsWith(e.href)?"text-white":"text-gray-400","\n                  rounded-lg py-2 flex items-center text-xs leading-none transition-colors duration-100\n                  ").concat(e.admin&&!h?"opacity-30 pointer-events-none":"","\n                "),children:[(0,s.jsx)("img",{src:e.icon,className:"\n                    ".concat(r.asPath.startsWith(e.href)?"":"opacity-40","\n                    mr-3 flex-shrink-0 h-[18px] w-[18px]\n                  ")}),e.name]})},e.name)}))}),(0,s.jsxs)("div",{className:"flex group mx-2 mb-2 p-2.5 pb-1 h-12 hover:h-[132px] transition-all duration-300 ease-in-out rounded-xl bg-transparent hover:bg-gray-900 overflow-hidden",children:[(0,s.jsx)("div",{className:"flex flex-none self-start items-stretch border border-violet-300/40 rounded-md w-[23px] h-[23px]",children:(0,s.jsx)("div",{className:"flex flex-1 justify-center items-center border border-violet-300/70 text-3xs rounded-[4px] leading-none font-normal m-0.5 select-none",children:(0,s.jsx)("span",{className:"inline-block -mt-0.5",children:null===d||void 0===d||null===(n=d.name)||void 0===n?void 0:n[0]})})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 ml-1 px-2 select-none",children:[(0,s.jsx)("div",{className:"text-gray-400 group-hover:text-white transition-colors duration-300 mt-[5px] mb-2 leading-none truncate text-2xs pb-px",children:null===d||void 0===d?void 0:d.name}),(0,s.jsxs)("nav",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[b.map((function(e){return(0,s.jsx)(a.default,{href:e.href,children:(0,s.jsx)("a",{className:"w-full flex py-1.5 text-xs text-gray-400 hover:text-white ".concat(e.admin&&!h?"pointer-events-none opacity-20":""),children:e.name})},e.name)})),(0,s.jsx)("button",{onClick:function(){return function(){return g.apply(this,arguments)}()},className:"w-full text-left py-1.5 text-gray-400 text-xs hover:text-white cursor-pointer",children:"Sign Out"}),(0,s.jsxs)("div",{className:"text-3xs mt-2 leading-none text-violet-50/40",children:["Infra version ",(0,s.jsx)("span",{className:"font-mono select-text",children:null===u||void 0===u?void 0:u.version})]})]})]})]})]}),(0,s.jsx)("main",{className:"w-full overflow-x-hidden overflow-y-scroll",children:(0,s.jsx)("div",{className:"mx-6 h-full",children:t})})]})}},1399:function(e,n,t){"use strict";t.d(n,{Z:function(){return a}});var r=t(5893),i=t(7533),s=t(8771);function a(e){var n=e.open,t=e.setOpen,a=e.onSubmit,o=e.title,l=e.message,c=e.onCancel;return(0,r.jsxs)(i.V,{as:"div",className:"fixed z-10 inset-0 overflow-y-auto flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center",open:n,onClose:function(){return t(!1)},children:[(0,r.jsx)(i.V.Overlay,{className:"fixed inset-0 bg-black bg-opacity-80 transition-opacity"}),(0,r.jsxs)("aside",{className:"relative inline-block rounded-lg text-left bg-black border border-gray-800 overflow-hidden transform transition-all align-middle max-w-xs w-full p-5",children:[(0,r.jsxs)("header",{className:"flex items-center my-2 text-left",children:[(0,r.jsx)(s.Z,{className:"h-6 w-6 stroke-[1.5] text-pink-400 mr-2","aria-hidden":"true"}),(0,r.jsx)(i.V.Title,{as:"h3",className:"text-sm",children:o})]}),(0,r.jsx)(i.V.Description,{className:"text-2xs text-gray-300 my-12",children:l}),(0,r.jsxs)("footer",{className:"mt-8 text-sm flex flex-row-reverse",children:[(0,r.jsx)("button",{type:"button",className:"text-violet-200 border border-violet-200 focus:outline-violet-100 focus:text-white outline-offset-0 leading-none rounded-md text-2xs ml-3 px-8",onClick:function(){return a()},children:"Delete"}),(0,r.jsx)("button",{type:"button",className:"px-8 py-2 text-3xs text-gray-400 uppercase focus:outline-none focus:text-gray-100",onClick:function(){return c&&c()},children:"Cancel"})]})]})]})}},661:function(e,n,t){"use strict";t.d(n,{A:function(){return i}});var r=t(8100);function i(){var e=(0,r.ZP)("/v1/identities/self").data,n=(0,r.ZP)((function(){return"/v1/identities/".concat(null===e||void 0===e?void 0:e.id,"/grants?resource=infra")})),t=n.data,i=n.error;return{loading:!t&&!i,admin:!!(null===t||void 0===t?void 0:t.find((function(e){return"admin"===e.privilege})))}}},8324:function(e,n,t){"use strict";t.d(n,{o:function(){return r}});var r=function(e){var n;return(null===(n=String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/))||void 0===n?void 0:n.length)>0}},5413:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return g}});var r=t(5893),i=t(9008),s=t(9540),a=t(4051),o=t.n(a),l=t(7294),c=t(8100),d=t(6763),u=t(8324),f=t(3783),x=t(1399),m=t(5686);function h(e,n,t,r,i,s,a){try{var o=e[s](a),l=o.value}catch(c){return void t(c)}o.done?n(l):Promise.resolve(l).then(r,i)}function v(e){var n,t=e.id,i=e.subject,s=e.grants;if(!t||!i)return null;var a=(0,c.ZP)("/v1/identities/".concat(i.replace("i:","")),{fallbackData:{name:"",kind:""}}).data,d=(0,c.ZP)("/v1/identities/self").data,u=(0,c.kY)().mutate,f=(0,l.useState)(!1),m=f[0],v=f[1],p=i.replace("i:","")===d.id;return(0,r.jsxs)("div",{className:"flex group",children:[(0,r.jsxs)("div",{className:"flex flex-1 items-center space-x-4 py-1",children:[(0,r.jsx)("div",{className:"border border-violet-300/20 flex-none flex items-center justify-center w-8 h-8 rounded-lg",children:(0,r.jsx)("div",{className:"border border-violet-300/40 flex-none text-gray-500 flex justify-center items-center text-sm w-6 h-6 rounded-[4px]",children:null===a||void 0===a||null===(n=a.name)||void 0===n?void 0:n[0]})}),(0,r.jsx)("div",{className:"flex flex-col leading-tight",children:(0,r.jsx)("div",{className:"text-2xs leading-none",children:a.name})})]}),(0,r.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 flex justify-end text-right",children:[!p&&(0,r.jsx)("button",{onClick:function(){return v(!0)},className:"flex-none p-2 -mr-2 cursor-pointer text-2xs text-gray-500 hover:text-violet-100",children:"Revoke"}),(0,r.jsx)(x.Z,{open:m,setOpen:v,onCancel:function(){return v(!1)},onSubmit:function(){u("/v1/grants?resource=infra&privilege=admin",function(){var e,n=(e=o().mark((function e(n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/v1/grants/".concat(t),{method:"DELETE"});case 2:return e.abrupt("return",null===n||void 0===n?void 0:n.filter((function(e){return(null===e||void 0===e?void 0:e.id)!==t})));case 3:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,i){var s=e.apply(n,t);function a(e){h(s,r,i,a,o,"next",e)}function o(e){h(s,r,i,a,o,"throw",e)}a(void 0)}))});return function(e){return n.apply(this,arguments)}}(),{optimisticData:s.filter((function(e){return(null===e||void 0===e?void 0:e.id)!==t}))}),v(!1)},title:"Revoke Admin",message:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to revoke admin access for ",(0,r.jsx)("span",{className:"font-bold text-white",children:a.name}),"?",(0,r.jsx)("br",{}),(0,r.jsx)("br",{})," This action cannot be undone."]})})]})]})}function p(){var e=(0,c.ZP)((function(){return"/v1/grants?resource=infra&privilege=admin"}),{fallbackData:[]}).data,n=(0,c.kY)().mutate,t=(0,l.useState)(""),i=t[0],s=t[1],a=(0,l.useState)(""),o=a[0],x=a[1],h=function(e){fetch("/v1/grants",{method:"POST",body:JSON.stringify({subject:"i:"+e,resource:"infra",privilege:"admin"})}).then((function(){n("/v1/grants?resource=infra&privilege=admin"),s("")})).catch((function(e){return x(e.message||"something went wrong, please try again later.")}))},p=function(){(0,u.o)(i)?(x(""),fetch("/v1/identities?name=".concat(i)).then((function(e){return e.json()})).then((function(e){0===e.length?fetch("/v1/identities",{method:"POST",body:JSON.stringify({name:i})}).then((function(e){return e.json()})).then((function(e){return h(e.id)})).catch((function(e){return console.error(e)})):h(e[0].id)}))):x("Invalid email")};return(0,r.jsxs)("div",{className:"sm:w-80 lg:w-[500px]",children:[(0,r.jsx)("div",{className:"text-2xs leading-none uppercase text-gray-400 border-b border-gray-800 pb-6",children:"Admins"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row ".concat(o?"mt-6 mb-2":"mt-6 mb-14"),children:[(0,r.jsx)("div",{className:"sm:flex-1",children:(0,r.jsx)(f.Z,{type:"email",value:i,placeholder:"Email address",hasDropdownSelection:!1,handleInputChange:function(e){return n=e.target.value,s(n),void x("");var n},handleKeyDown:function(e){"Enter"===e.key&&i.length>0&&p()},error:o})}),(0,r.jsxs)("button",{onClick:function(){return p()},disabled:0===i.length,type:"button",className:"flex items-center cursor-pointer border border-violet-300 px-5 mt-4 text-2xs sm:ml-4 sm:mt-0 rounded-md disabled:pointer-events-none disabled:opacity-30",children:[(0,r.jsx)(d.Z,{className:"w-3 h-3 mr-1.5"}),"Add Admin"]})]}),o&&(0,r.jsx)("div",{className:"mb-10",children:(0,r.jsx)(m.Z,{message:o})}),(0,r.jsx)("h4",{className:"text-gray-400 my-3 text-2xs",children:"These users have full administration privileges"}),e.map((function(n){return(0,r.jsx)(v,{id:n.id,subject:n.subject,grants:e},n.id)}))]})}function g(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.default,{children:(0,r.jsx)("title",{children:"Settings - Infra"})}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col space-y-8 mt-6 mb-4",children:[(0,r.jsx)("h1",{className:"text-xs mb-6 font-bold",children:"Settings"}),(0,r.jsx)(p,{})]})]})}g.layout=function(e){return(0,r.jsx)(s.Z,{children:e})}}},function(e){e.O(0,[551,774,888,179],(function(){return n=3733,e(e.s=n);var n}));var n=e.O();_N_E=n}]);