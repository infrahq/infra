(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[943],{6870:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/destinations",function(){return n(8188)}])},3251:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(5893),i=n(1664),s=n.n(i),o=n(1431);function a(e){var t=e.title,n=e.subtitle,i=e.iconPath,a=e.buttonText,l=e.buttonHref;return(0,r.jsxs)("div",{className:"flex flex-col text-center my-24",children:[(0,r.jsx)(o.Z,{iconPath:i,position:"center"}),(0,r.jsx)("h1",{className:"text-base font-bold mb-2",children:t}),(0,r.jsx)("h2",{className:"text-gray-300 mb-4 text-sm max-w-xs mx-auto",children:n}),l&&(0,r.jsx)(s(),{href:l,children:(0,r.jsx)("button",{className:"bg-gradient-to-tr from-indigo-300 to-pink-100 hover:from-indigo-200 hover:to-pink-50 rounded-full p-0.5 my-2 mx-auto",children:(0,r.jsx)("div",{className:"bg-black rounded-full flex items-center tracking-tight text-sm px-6 py-3",children:a})})})]})}},5686:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(5893);function i(e){var t=e.message,n=e.center,i=void 0!==n&&n;return(0,r.jsx)("p",{className:"".concat(i?"mt-2 text-center":"px-4 mb-1"," text-sm text-pink-500"),children:t})}},3783:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(5893);function i(e){var t=e.type,n=e.value,i=e.placeholder,s=e.handleInputChange,o=e.handleKeyDown,a=e.disabled,l=void 0!==a&&a,c=e.error,u=e.hasDropdownSelection,d=void 0===u||u,f=e.optionType,m=e.options,v=e.handleSelectOption,h=e.selectedItem;return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"relative w-full px-4 py-3  border bg-transparent rounded-full focus:outline-none focus:ring focus:ring-cyan-600 disabled:opacity-30 ".concat(c?"border-pink-500":"border-gray-800"),children:[(0,r.jsx)("input",{autoFocus:!0,spellCheck:"false",type:t,value:n,className:"block ".concat(d?"w-10/12":"w-full"," sm:text-sm bg-transparent focus:outline-none"),placeholder:i,onChange:s,onKeyDown:o,disabled:l}),d&&(0,r.jsxs)("div",{className:"absolute inset-y-0 right-6 flex items-center",children:[(0,r.jsx)("label",{htmlFor:f,className:"sr-only",children:f}),(0,r.jsx)("select",{id:f,name:f,onChange:v,value:h,className:"h-full py-0 pl-2 border-transparent bg-transparent text-sm focus:outline-none",children:m.map((function(e){return(0,r.jsx)("option",{value:e,children:e},e)}))})]})]})})}},5140:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(5893);function i(){return(0,r.jsx)("div",{className:"h-full -mt-20 flex items-center justify-center",children:(0,r.jsx)("img",{className:"w-20 h-20 animate-spin-fast",src:"/spinner.svg"})})}},8324:function(e,t,n){"use strict";n.d(t,{o:function(){return r}});var r=function(e){var t;return(null===(t=String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/))||void 0===t?void 0:t.length)>0}},8188:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return H}});var r=n(4051),i=n.n(r),s=n(5893),o=n(8100),a=n(9008),l=n(1664),c=n.n(l),u=n(7294),d=n(9521),f=n(7484),m=n.n(f);var v=u.forwardRef((function(e,t){return u.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:t},e),u.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"}))})),h=n(5506),x=n(661),p=n(9540),g=n(5140),b=n(5857),y=n(3251),j=n(1431),w=n(1399),N=n(8324),k=n(3783),C=n(5686),S=n(7533);function O(e){var t=e.header,n=e.children,r=e.handleCloseModal,i=e.modalOpen,o=e.iconPath;return(0,s.jsx)(S.V,{as:"div",className:"fixed z-10 inset-0 overflow-y-auto",open:i,onClose:r,children:(0,s.jsxs)("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,s.jsx)(S.V.Overlay,{className:"fixed inset-0 bg-black bg-opacity-75 transition-opacity"}),(0,s.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"\u200b"}),(0,s.jsx)("div",{className:"relative inline-block align-bottom bg-gradient-to-br from-violet-400/30 to-pink-200/30 rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:align-middle w-full max-w-3xl",children:(0,s.jsx)("div",{className:"items-center justify-center bg-black rounded-xl m-0.5",children:(0,s.jsxs)("div",{className:"flex flex-row p-4",children:[(0,s.jsx)("div",{className:"hidden lg:flex self-start mr-4 bg-gradient-to-br from-violet-400/30 to-pink-200/30 rounded-full",children:(0,s.jsx)("div",{className:"flex bg-black items-center justify-center rounded-full w-16 h-16 m-0.5",children:(0,s.jsx)("img",{className:"w-8 h-8",src:o})})}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col space-y-4",children:[(0,s.jsx)(S.V.Title,{as:"h1",className:"text-base leading-6 font-bold pt-6 pl-3",children:t}),(0,s.jsx)("div",{className:"pb-3 pr-3 sm:pb-6 sm:pr-6",children:n})]})]})})})]})})}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Z(e,t,n,r,i,s,o){try{var a=e[s](o),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(r,i)}function A(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Z(s,r,i,o,a,"next",e)}function a(e){Z(s,r,i,o,a,"throw",e)}o(void 0)}))}}function E(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e){var t=e.id;if(!t)return null;var n=(0,o.ZP)("/v1/users/".concat(t.replace("i:","")),{fallbackData:{name:""}}).data;return(0,s.jsx)("p",{className:"text-sm",children:n.name})}function I(e){var t,n=e.id,r=e.modalOpen,a=e.handleCloseModal,l=(0,o.ZP)("/v1/destinations/".concat(n)).data,c=(0,o.ZP)((function(){return"/v1/grants?resource=".concat(l.name)})).data,d=(0,o.kY)().mutate,f=(0,u.useState)(""),m=f[0],v=f[1],h=(0,u.useState)(""),x=h[0],p=h[1],g=(0,u.useState)(""),b=g[0],y=g[1],j=(0,u.useState)("view"),w=j[0],S=j[1],P=["view","edit","admin","remove"],Z=function(){var e=A(i().mark((function e(t){var n,r,s,o=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=o.length>1&&void 0!==o[1]?o[1]:w,r=o.length>2&&void 0!==o[2]&&o[2],s=o.length>3?o[3]:void 0,d("/v1/grants?resource=".concat(l.name),function(){var e=A(i().mark((function e(o){var a,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/v1/grants",{method:"POST",body:JSON.stringify({identity:t,resource:l.name,privilege:n})});case 2:return a=e.sent,e.next=5,a.json();case 5:if(c=e.sent,!r){e.next=9;break}return e.next=9,fetch("/v1/grants/".concat(s),{method:"DELETE"});case 9:return v(""),e.abrupt("return",E(((null===o||void 0===o?void 0:o.items)||[]).filter((function(e){return(null===e||void 0===e?void 0:e.identity)!==t}))).concat([c]));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=A(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,N.o)(m)){e.next=32;break}return p(""),e.prev=2,e.next=5,fetch("/v1/users?name=".concat(m));case 5:return t=e.sent,e.next=8,t.json();case 8:if(n=e.sent,t.ok){e.next=11;break}throw n;case 11:if(0!==n.count){e.next=24;break}return e.next=14,fetch("/v1/users",{method:"POST",body:JSON.stringify({name:m})});case 14:return t=e.sent,e.next=17,t.json();case 17:return r=e.sent,e.next=20,Z("i:"+r.id);case 20:v(""),S("view"),e.next=25;break;case 24:Z("i:"+n.items[0].id);case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(2),y(e.t0.message||"something went wrong, please try again later.");case 30:e.next=33;break;case 32:p("Invalid email");case 33:case"end":return e.stop()}}),e,null,[[2,27]])})));return function(){return e.apply(this,arguments)}}();return(0,s.jsxs)(O,{header:"Share",handleCloseModal:a,modalOpen:r,iconPath:"/grant-access-color.svg",children:[(0,s.jsxs)("div",{className:"flex gap-1 mt-3 ".concat(x?"mb-2":"mb-6"),children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(k.Z,{type:"email",value:m,placeholder:"email",error:x,optionType:"role",options:P.filter((function(e){return"remove"!==e})),handleInputChange:function(e){return t=e.target.value,v(t),void p("");var t},handleSelectOption:function(e){return S(e.target.value)},handleKeyDown:function(e){"Enter"===e.key&&m.length>0&&I()},selectedItem:w})}),(0,s.jsx)("button",{onClick:function(){return I()},disabled:0===m.length,type:"button",className:"bg-gradient-to-tr from-indigo-300 to-pink-100 rounded-full hover:from-indigo-200 hover:to-pink-50 p-0.5 ml-4 disabled:opacity-30",children:(0,s.jsx)("div",{className:"bg-black flex items-center text-sm rounded-full px-12 py-2.5",children:"Share"})})]}),x&&(0,s.jsx)(C.Z,{message:x}),(null===c||void 0===c?void 0:c.count)>0&&(0,s.jsx)("div",{className:"py-2 max-h-48 sm:max-h-80 overflow-y-auto",children:null===c||void 0===c||null===(t=c.items)||void 0===t?void 0:t.sort((function(e,t){return e.identity.localeCompare(t.identity)})).map((function(e){return(0,s.jsxs)("div",{className:"flex justify-between items-center px-4",children:[(0,s.jsx)(T,{id:e.identity}),(0,s.jsx)("div",{children:(0,s.jsx)("select",{id:"role",name:"role",className:"w-full pl-3 pr-1 py-2 border-gray-300 focus:outline-none sm:text-sm bg-transparent",defaultValue:e.privilege,onChange:function(t){return function(e,t,n){var r;if("remove"!==e)return Z(n,e,!0,t);d("/v1/grants?resource=".concat(l.name),function(){var e=A(i().mark((function e(n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,fetch("/v1/grants/".concat(t),{method:"DELETE"});case 3:return e.abrupt("return",null===n||void 0===n||null===(r=n.items)||void 0===r?void 0:r.filter((function(e){return(null===e||void 0===e?void 0:e.id)!==t})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{optimisticData:null===c||void 0===c||null===(r=c.items)||void 0===r?void 0:r.filter((function(e){return(null===e||void 0===e?void 0:e.id)!==t}))})}(t.target.value,e.id,e.identity)},children:P.map((function(e){return(0,s.jsx)("option",{value:e,children:e},e)}))})})]},e.id)}))}),b&&(0,s.jsx)(C.Z,{message:b})]})}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _(e,t,n,r,i,s,o){try{var a=e[s](o),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(r,i)}function M(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){_(s,r,i,o,a,"next",e)}function a(e){_(s,r,i,o,a,"throw",e)}o(void 0)}))}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){L(e,t,n[t])}))}return e}function F(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(){var e,t=(0,o.ZP)("/v1/destinations"),n=t.data,r=t.error,l=(0,x.A)(),f=l.admin,p=l.loading,N=(0,d.useTable)({columns:(0,u.useMemo)((function(){return function(e){return[{Header:"Cluster",accessor:"name",Cell:function(e){var t=e.value;return(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("div",{className:"py-2",children:t})})}},{Header:"Added",accessor:function(e){return m()(e.created).fromNow()}}].concat(F(e?[{id:"access",accessor:function(e){return e},Header:function(){return(0,s.jsx)("div",{className:"text-right",children:"Access"})},Cell:function(e){var t,n,r=e.row,i=(0,u.useState)(!1),a=i[0],l=i[1],c=(0,o.ZP)("/v1/grants?resource=".concat(r.original.name)).data,d=new Set(null===c||void 0===c||null===(t=c.items)||void 0===t?void 0:t.filter((function(e){var t;return!(null===e||void 0===e||null===(t=e.subject)||void 0===t?void 0:t.startsWith("g:"))}))).size,f=new Set(null===c||void 0===c||null===(n=c.items)||void 0===n?void 0:n.filter((function(e){var t;return null===e||void 0===e||null===(t=e.subject)||void 0===t?void 0:t.startsWith("g:")}))).size;return(0,s.jsxs)("div",{className:"flex text-right justify-end w-24 h-8 ml-auto",children:[c&&(0,s.jsx)("div",{className:"group-hover:hidden flex justify-center items-center text-gray-300",children:0===d&&0===f?(0,s.jsx)("div",{children:"No access"}):(0,s.jsxs)(s.Fragment,{children:[d>0&&(0,s.jsxs)("div",{children:[d,"\xa0User",d>1&&"s"]}),d>0&&f>0&&(0,s.jsx)("div",{className:"mx-1",children:"\u2022"}),f>0&&(0,s.jsxs)("div",{children:[f,"\xa0Group",f>1&&"s"]})]})}),(0,s.jsxs)("div",{className:"group-hover:flex space-x-1 hidden",children:[(0,s.jsx)("button",{onClick:function(){return l(!0)},className:"cursor-pointer bg-zinc-900 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-center py-1 px-3 text-gray-300 hover:text-white",children:[(0,s.jsx)(v,{className:"w-4 h-4 "}),(0,s.jsx)("div",{className:"text-sm ml-1",children:"Share"})]})}),(0,s.jsx)(I,{id:r.original.id,modalOpen:a,handleCloseModal:function(){return l(!1)}})]})]})}}]:[]),F(e?[{id:"remove",accessor:function(e){return e},Cell:function(e){var t=e.rows,n=e.value,r=n.id,a=n.name,l=(0,o.kY)().mutate,c=(0,u.useState)(!1),d=c[0],f=c[1];return(0,s.jsxs)("div",{className:"flex justify-end w-6 ml-auto opacity-0 group-hover:opacity-100",children:[(0,s.jsx)("button",{onClick:function(){return f(!0)},className:"py-1 px-2 -mr-2 cursor-pointer",children:(0,s.jsx)(h.Z,{className:"w-5 h-5 text-gray-500 hover:text-white"})}),(0,s.jsx)(w.Z,{open:d,setOpen:f,onSubmit:M(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l("/v1/destinations",function(){var e=M(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,fetch("/v1/destinations/".concat(r),{method:"DELETE"});case 3:return e.abrupt("return",null===t||void 0===t||null===(n=t.items)||void 0===n?void 0:n.filter((function(e){return(null===e||void 0===e?void 0:e.id)!==r})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{optimisticData:t.map((function(e){return e.original})).filter((function(e){return(null===e||void 0===e?void 0:e.id)!==r}))}),f(!1);case 2:case"end":return e.stop()}}),e)}))),title:"Delete Cluster",message:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to disconnect ",(0,s.jsxs)("span",{className:"text-white font-bold",children:[a,"?"]}),(0,s.jsx)("br",{}),"Note: you must also uninstall the Infra Connector from this cluster."]})})]})}}]:[]))}(f)}),[f]),data:(null===n||void 0===n?void 0:n.items)||[]}),k=p||!n&&!r;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.default,{children:(0,s.jsx)("title",{children:"Destinations - Infra"})}),k?(0,s.jsx)(g.Z,{}):(0,s.jsxs)("div",{className:"flex flex-row mt-4 lg:mt-6",children:[(null===n||void 0===n?void 0:n.count)>0&&(0,s.jsx)("div",{className:"mt-2 mr-8",children:(0,s.jsx)(j.Z,{iconPath:"/destinations-color.svg"})}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col space-y-4",children:[(null===n||void 0===n?void 0:n.count)>0&&(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h1",{className:"text-base font-bold mt-6 mb-4",children:"Clusters"}),f&&(0,s.jsx)(c(),{href:"/destinations/add",children:(0,s.jsx)("button",{className:"bg-gradient-to-tr from-indigo-300 to-pink-100 hover:from-indigo-200 hover:to-pink-50 rounded-full p-0.5 my-2",children:(0,s.jsx)("div",{className:"bg-black rounded-full flex items-center text-sm px-4 py-1.5 ",children:"Add Cluster"})})})]}),(null===r||void 0===r?void 0:r.status)?(0,s.jsx)("div",{className:"my-20 text-center font-light text-gray-300 text-sm",children:null===r||void 0===r||null===(e=r.info)||void 0===e?void 0:e.message}):0===(null===n||void 0===n?void 0:n.count)?(0,s.jsx)(y.Z,{title:"There are no clusters",subtitle:"There are currently no clusters connected to Infra. Get started by connecting one.",iconPath:"/destinations-color.svg",buttonHref:f&&"/destinations/add",buttonText:"Add Cluster"}):(0,s.jsx)(b.Z,z({},N))]})]})]})}H.layout=function(e){return(0,s.jsx)(p.Z,{children:e})}},5506:function(e,t,n){"use strict";var r=n(7294);const i=r.forwardRef((function(e,t){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor","aria-hidden":"true",ref:t},e),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"}))}));t.Z=i}},function(e){e.O(0,[788,203,774,888,179],(function(){return t=6870,e(e.s=t);var t}));var t=e.O();_N_E=t}]);