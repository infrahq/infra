(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[278],{9866:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/destinations/add",function(){return t(8036)}])},1431:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var r=t(5893);function o(e){var n=e.iconPath,t=e.size,o=void 0===t?8:t,i=e.position;return(0,r.jsx)("div",{className:"flex items-center justify-center bg-gradient-to-br from-violet-400/30 to-pink-200/30 rounded-full ".concat("center"===i?"mx-auto my-4":""),children:(0,r.jsx)("div",{className:"flex bg-black items-center justify-center rounded-full w-16 h-16 m-0.5",children:(0,r.jsx)("img",{className:"w-".concat(o," h-").concat(o),src:n})})})}},3783:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var r=t(5893);function o(e){var n=e.type,t=e.value,o=e.placeholder,i=e.handleInputChange,a=e.handleKeyDown,s=e.disabled,c=void 0!==s&&s,l=e.error,u=e.hasDropdownSelection,d=void 0===u||u,f=e.optionType,m=e.options,h=e.handleSelectOption,p=e.selectedItem;return(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"relative w-full px-4 py-3  border bg-transparent rounded-full focus:outline-none focus:ring focus:ring-cyan-600 disabled:opacity-30 ".concat(l?"border-pink-500":"border-gray-800"),children:[(0,r.jsx)("input",{autoFocus:!0,spellCheck:"false",type:n,value:t,className:"block ".concat(d?"w-10/12":"w-full"," sm:text-sm bg-transparent focus:outline-none"),placeholder:o,onChange:i,onKeyDown:a,disabled:c}),d&&(0,r.jsxs)("div",{className:"absolute inset-y-0 right-6 flex items-center",children:[(0,r.jsx)("label",{htmlFor:f,className:"sr-only",children:f}),(0,r.jsx)("select",{id:f,name:f,onChange:h,value:p,className:"h-full py-0 pl-2 border-transparent bg-transparent text-sm focus:outline-none",children:m.map((function(e){return(0,r.jsx)("option",{value:e,children:e},e)}))})]})]})})}},8036:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return h}});var r=t(5893),o=t(9008),i=t(1163),a=t(7294),s=t(8100),c=t(6389),l=t(1431),u=t(3783);function d(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function f(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"===typeof e)return d(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return d(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){var n=e.enabledCommandInput,t=e.accessKey,o=e.currentDestinationName,i=window.location.host,a=window.location.origin.includes("https"),s="helm install infra-connector infrahq/infra \\\n  --set connector.config.accessKey=".concat(t," \\\n  --set connector.config.server=").concat(i," \\\n  --set connector.config.name=").concat(o),c=n?a?s:s+" \\\n  --set connector.config.skipTLSVerify=true":"";return(0,r.jsx)("div",{className:"border border-gray-800 rounded-lg shadow-sm overflow-hidden my-5",children:(0,r.jsx)("textarea",{spellCheck:"false",rows:5,name:"commandInput",id:"commandInput",className:"block w-full px-5 py-4 border-0 resize-none sm:text-sm bg-black focus:outline-none whitespace-pre font-mono",value:c,readOnly:!0})})}function h(){var e=(0,s.ZP)("/v1/destinations").data,n=(0,a.useState)(""),t=n[0],d=n[1],h=(0,a.useState)(""),p=h[0],x=h[1],g=(0,a.useState)(""),y=g[0],b=g[1],v=(0,a.useState)(!1),j=v[0],w=v[1],N=(0,a.useState)(!1),k=N[0],C=N[1],S=(0,a.useState)(!1),I=S[0],T=S[1],_=(0,a.useState)(0),D=_[0],A=_[1];(0,a.useEffect)((function(){var e=function(){t&&p.length>0&&fetch("/v1/destinations?name=".concat(p)).then((function(e){return e.json()})).then((function(t){j||(t.length===D?n=setTimeout(e,5e3):(w(!0),clearTimeout(n)))})).catch((function(e){console.error(e),clearTimeout(n)}))},n=setTimeout(e,5e3);return function(){clearTimeout(n)}}),[t]);var E=function(){T(!0),b(p),C(p.length>0),A(null===e||void 0===e?void 0:e.filter((function(e){return e.name===p})).length),fetch("/v1/identities?name=connector").then((function(e){return e.json()})).then((function(e){return{identityID:e[0].id,name:p+"-"+f(Array(10)).map((function(){return(~~(36*Math.random())).toString(36)})).join(""),ttl:"87600h",extensionDeadline:"720h"}})).then((function(e){return fetch("/v1/access-keys",{method:"POST",body:JSON.stringify(e)})})).then((function(e){return e.json()})).then((function(e){d(e.accessKey)})).catch((function(e){return console.error(e)}))};return(0,r.jsxs)(c.Z,{closeHref:"/destinations",verticalCenteredContent:!1,children:[(0,r.jsx)(o.default,{children:(0,r.jsx)("title",{children:"Infra - Destinations"})}),(0,r.jsxs)("div",{className:"flex flex-col mb-10 w-full max-w-md",children:[(0,r.jsx)(l.Z,{iconPath:"/destinations-color.svg",position:"center"}),(0,r.jsx)("h1",{className:"text-base font-bold tracking-tight text-center",children:"Connect a Cluster"}),(0,r.jsxs)("div",{className:"flex gap-1 mt-8 mb-5",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(u.Z,{type:"text",value:p,placeholder:"Choose a name for your cluster",hasDropdownSelection:!1,handleInputChange:function(e){return x(e.target.value)},handleKeyDown:function(e){"Enter"===e.key&&p.length>0&&E()},disabled:I})}),(0,r.jsx)("button",{onClick:function(){return E()},disabled:0===p.length||I,type:"button",className:"bg-gradient-to-tr from-indigo-300 to-pink-100 hover:from-indigo-200 hover:to-pink-50 p-0.5 ml-2 rounded-full disabled:opacity-30",children:(0,r.jsx)("div",{className:"bg-black flex items-center text-sm px-12 py-2.5 rounded-full",children:"Next"})})]}),k&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("h2",{className:"text-gray-300 text-center px-2 mt-4",children:["Next, deploy the Infra Connector to your cluster via ",(0,r.jsx)("span",{className:"font-mono",children:"helm:"})]}),(0,r.jsx)(m,{enabledCommandInput:k,accessKey:t,currentDestinationName:y}),(0,r.jsx)("h2",{className:"text-gray-300 text-center px-2 mb-2 mt-4",children:"Your cluster will be detected automatically. This may take a few minutes."}),(0,r.jsx)("div",{className:"border border-dashed border-pink-light/20 rounded-lg shadow-sm overflow-hidden my-5 px-5 py-3",children:(0,r.jsxs)("div",{className:"flex items-center justify-center p-0.5 w-full",children:[(0,r.jsx)("img",{className:"w-8 h-8' ".concat(j?"":"animate-pulse"),src:"/connected-icon.svg"}),(0,r.jsx)("p",{className:"text-pink-dark text-sm px-2 py-3",children:j?"Connected!":"Waiting for connection..."})]})}),j&&(0,r.jsx)("button",{onClick:function(){i.default.replace("/destinations")},disabled:0===p.length,type:"button",className:"bg-gradient-to-tr from-indigo-300 to-pink-100 hover:from-indigo-200 hover:to-pink-50 rounded-full p-0.5 w-full mt-6 text-center",children:(0,r.jsx)("div",{className:"bg-black rounded-full tracking-tight text-sm px-6 py-3",children:"Finished"})})]})]})]})}}},function(e){e.O(0,[389,774,888,179],(function(){return n=9866,e(e.s=n);var n}));var n=e.O();_N_E=n}]);