(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[278],{640:function(e,t,n){"use strict";var r=n(1742),a={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(e,t){var n,o,s,c,i,l,u=!1;t||(t={}),n=t.debug||!1;try{if(s=r(),c=document.createRange(),i=document.getSelection(),(l=document.createElement("span")).textContent=e,l.style.all="unset",l.style.position="fixed",l.style.top=0,l.style.clip="rect(0, 0, 0, 0)",l.style.whiteSpace="pre",l.style.webkitUserSelect="text",l.style.MozUserSelect="text",l.style.msUserSelect="text",l.style.userSelect="text",l.addEventListener("copy",(function(r){if(r.stopPropagation(),t.format)if(r.preventDefault(),"undefined"===typeof r.clipboardData){n&&console.warn("unable to use e.clipboardData"),n&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var o=a[t.format]||a.default;window.clipboardData.setData(o,e)}else r.clipboardData.clearData(),r.clipboardData.setData(t.format,e);t.onCopy&&(r.preventDefault(),t.onCopy(r.clipboardData))})),document.body.appendChild(l),c.selectNodeContents(l),i.addRange(c),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");u=!0}catch(d){n&&console.error("unable to copy using execCommand: ",d),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),u=!0}catch(d){n&&console.error("unable to copy using clipboardData: ",d),n&&console.error("falling back to prompt"),o=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in t?t.message:"Copy to clipboard: #{key}, Enter"),window.prompt(o,e)}}finally{i&&("function"==typeof i.removeRange?i.removeRange(c):i.removeAllRanges()),l&&document.body.removeChild(l),s()}return u}},9866:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/destinations/add",function(){return n(8036)}])},8036:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var r=n(4051),a=n.n(r),o=n(5893),s=n(9008),c=n(1664),i=n(7294),l=n(640),u=n.n(l),d=n(3688);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t,n,r,a,o,s){try{var c=e[o](s),i=c.value}catch(l){return void n(l)}c.done?t(i):Promise.resolve(i).then(r,a)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){p(o,r,a,s,c,"next",e)}function c(e){p(o,r,a,s,c,"throw",e)}s(void 0)}))}}function x(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(){var e=(0,i.useState)(""),t=e[0],n=e[1],r=(0,i.useState)(""),l=r[0],d=r[1],f=(0,i.useState)(!1),p=f[0],y=f[1],h=(0,i.useState)(!1),b=h[0],g=h[1],v=(0,i.useState)(!1),w=v[0],j=v[1];function N(){return C.apply(this,arguments)}function C(){return(C=m(a().mark((function e(){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&l.length>0)){e.next=8;break}return e.next=3,fetch("/v1/destinations?name=".concat(l));case 3:return n=e.sent,e.next=6,n.json();case 6:e.sent.length>0&&g(!0);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return(S=m(a().mark((function e(){var t,r,o,s,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(!1),e.next=3,fetch("/v1/identities?name=connector");case 3:return t=e.sent,e.next=6,t.json();case 6:return r=e.sent,o=r[0].id,s=l+"-"+x(Array(10)).map((function(){return(~~(36*Math.random())).toString(36)})).join(""),e.next=11,fetch("/v1/access-keys",{method:"POST",body:JSON.stringify({userID:o,name:s,ttl:"87600h",extensionDeadline:"720h"})});case 11:return t=e.sent,e.next=14,t.json();case 14:c=e.sent,n(c.accessKey);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,i.useEffect)((function(){var e=setInterval(N,5e3);return function(){clearInterval(e)}}),[t]);var D=window.location.host,E="helm install infra-connector infrahq/infra \\\n    --set connector.config.accessKey=".concat(t," \\\n    --set connector.config.server=").concat(D," \\\n    --set connector.config.name=").concat(l," \\\n    --set connector.config.skipTLSVerify=true");return(0,o.jsxs)("div",{children:[(0,o.jsx)(s.default,{children:(0,o.jsx)("title",{children:"Add Infrastructure - Infra"})}),(0,o.jsxs)("header",{className:"flex flex-row px-4 pt-5 pb-6 items-center",children:[(0,o.jsx)("img",{src:"/destinations.svg",className:"w-6 h-6 mr-2 mt-0.5"}),(0,o.jsx)("h1",{className:"text-2xs capitalize",children:"Connect infrastructure"})]}),(0,o.jsxs)("form",{onSubmit:function(e){return e.preventDefault(),y(!0),function(){S.apply(this,arguments)}(),!1},className:"flex space-x-2 px-4 mb-10",children:[(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)("label",{className:"text-3xs text-gray-400 uppercase",children:"Cluster Name"}),(0,o.jsx)("input",{autoFocus:!0,required:!0,placeholder:"provide a cluster name",value:l,onChange:function(e){return d(e.target.value)},disabled:p,className:"w-full bg-transparent border-b border-gray-800 text-3xs px-px py-2 focus:outline-none focus:border-b focus:border-gray-200 placeholder:italic disabled:opacity-10"})]}),(0,o.jsx)("button",{className:"flex-none border border-violet-300 rounded-md text-violet-100 self-end text-2xs px-4 py-2 disabled:opacity-10",disabled:p,children:"Next"})]}),(0,o.jsxs)("section",{className:"flex flex-col my-2 ".concat(p?"":"opacity-10 pointer-events-none"),children:[(0,o.jsx)("h2",{className:"px-4 text-2xs mb-2 text-gray-100",children:"Run this command on your Kubernetes cluster:"}),(0,o.jsx)("pre",{className:"text-2xs p-4 min-h-[120px] text-gray-300 bg-gray-900 ".concat(p?"overflow-auto":"overflow-hidden"),children:p?E:""}),(0,o.jsx)("button",{className:"self-end text-3xs text-violet-200 mt-2 mb-3 py-2 px-3 mr-2 font-medium uppercase disabled:text-gray-500",disabled:w,onClick:function(){u()(E),j(!0),setTimeout((function(){return j(!1)}),2e3)},children:w?"\u2713 Copied":"Copy command"}),(0,o.jsxs)("p",{className:"text-gray-500 text-2xs px-4",children:["Your cluster will be detected automatically.",(0,o.jsx)("br",{}),"This may take a few minutes."]}),b?(0,o.jsxs)("footer",{className:"flex justify-between px-4 my-4 mr-3 items-center",children:[(0,o.jsx)("h3",{className:"text-2xs text-gray-200",children:"\u2713 Connected"}),(0,o.jsx)(c.default,{href:"/destinations",children:(0,o.jsx)("a",{className:"flex-none border border-violet-300 rounded-md text-violet-100 self-end text-2xs px-4 py-2 disabled:opacity-20",disabled:p,children:"Finish"})})]}):(0,o.jsxs)("footer",{className:"flex items-center px-4 my-7",children:[(0,o.jsx)("h3",{className:"text-2xs mr-3 text-gray-200",children:"Waiting for connection"}),p&&(0,o.jsx)("span",{className:"animate-[ping_1.25s_ease-in-out_infinite] flex-none inline-flex h-2 w-2 rounded-full border border-white opacity-75"})]})]})]})}y.layout=function(e){return(0,o.jsx)(d.Z,{closeHref:"/destinations",children:e})}},1742:function(e){e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,n=[],r=0;r<e.rangeCount;r++)n.push(e.getRangeAt(r));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach((function(t){e.addRange(t)})),t&&t.focus()}}}},function(e){e.O(0,[700,774,888,179],(function(){return t=9866,e(e.s=t);var t}));var t=e.O();_N_E=t}]);