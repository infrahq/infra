PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE `identities` (`id` integer,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`name` text,`last_seen_at` datetime,`created_by` integer,PRIMARY KEY (`id`));
INSERT INTO identities VALUES(75225930155761664,'2022-07-27 14:00:59.379086552+00:00','2022-07-27 14:00:59.379086552+00:00',NULL,'example@infrahq.com','0001-01-01 00:00:00+00:00',1);
INSERT INTO identities VALUES(75225930445168642,'2022-07-27 14:00:59.448524552+00:00','2022-07-27 14:00:59.448524552+00:00',NULL,'connector','0001-01-01 00:00:00+00:00',1);
CREATE TABLE `providers` (`id` integer,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`name` text,`kind` text,`url` text,`client_id` text,`client_secret` text,`auth_url` text,`scopes` text,`created_by` integer,`private_key` text,`client_email` text,`domain_admin_email` text,PRIMARY KEY (`id`));
INSERT INTO providers VALUES(75225930151567360,'2022-07-27 14:00:59.378596593+00:00','2022-07-27 14:00:59.378596593+00:00',NULL,'okta','okta','example.okta.com','aaa','bbb','https://example.okta.com/oauth2/v1/authorize','openid,email,offline_access,groups',1,'','','');
INSERT INTO providers VALUES(75225930151567361,'2022-07-27 14:00:59.378932593+00:00','2022-07-27 14:00:59.378932593+00:00',NULL,'infra','infra','','','aaa','','',1,'bbb','','');
CREATE TABLE `provider_users` (`identity_id` integer,`provider_id` integer, `id` integer, `created_at` datetime, `updated_at` datetime, `deleted_at` datetime, `email` text, `groups` text, `last_update` datetime, `redirect_url` text, `access_token` text, `refresh_token` text, `expires_at` datetime,PRIMARY KEY (`identity_id`,`provider_id`),CONSTRAINT `fk_provider_users_identity` FOREIGN KEY (`identity_id`) REFERENCES `identities`(`id`),CONSTRAINT `fk_provider_users_provider` FOREIGN KEY (`provider_id`) REFERENCES `providers`(`id`));
INSERT INTO provider_users VALUES(75225930155761664,75225930151567361,75225930445168641,'2022-07-27 14:00:59.448460885+00:00','2022-07-27 14:00:59.448460885+00:00',NULL,'example@infrahq.com','','2022-07-27 14:00:59.448457343+00:00','','aaa','bbb','0001-01-01 00:00:00+00:00');
INSERT INTO provider_users VALUES(75226263833616384,75225930151567360,75226263837810688,'2022-07-27 14:02:18.934641547+00:00','2022-07-27 14:02:19.547474589+00:00','2022-07-27 14:00:59.448457344+00:00','example@infrahq.com','','2022-07-27 14:02:19.54741888+00:00','http://localhost:8301','aaa','bbb','2022-07-27 15:02:18.420551838+00:00');
CREATE TABLE `groups` (`id` integer,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`name` text,`created_by` integer,`created_by_provider` integer,PRIMARY KEY (`id`));
CREATE TABLE `identities_groups` (`group_id` integer,`identity_id` integer,PRIMARY KEY (`group_id`,`identity_id`),CONSTRAINT `fk_identities_groups_group` FOREIGN KEY (`group_id`) REFERENCES `groups`(`id`),CONSTRAINT `fk_identities_groups_identity` FOREIGN KEY (`identity_id`) REFERENCES `identities`(`id`));
CREATE TABLE `grants` (`id` integer,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`subject` text,`privilege` text,`resource` text,`created_by` integer,PRIMARY KEY (`id`));
CREATE TABLE `destinations` (`id` integer,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`name` text,`unique_id` text,`last_seen_at` datetime,`version` text,`connection_url` text,`connection_ca` text,`resources` text,`roles` text,PRIMARY KEY (`id`));
CREATE TABLE `access_keys` (`id` integer,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`name` text,`issued_for` integer,`provider_id` integer,`scopes` text,`expires_at` datetime,`extension` integer,`extension_deadline` datetime,`key_id` text,`secret_checksum` blob,PRIMARY KEY (`id`),CONSTRAINT `fk_access_keys_issued_for_identity` FOREIGN KEY (`issued_for`) REFERENCES `identities`(`id`));
CREATE TABLE `settings` (`id` integer,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`private_jwk` blob,`public_jwk` blob,`lowercase_min` integer DEFAULT 0,`uppercase_min` integer DEFAULT 0,`number_min` integer DEFAULT 0,`symbol_min` integer DEFAULT 0,`length_min` integer DEFAULT 8,PRIMARY KEY (`id`));
CREATE TABLE `encryption_keys` (`id` integer,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`key_id` integer,`name` text,`encrypted` blob,`algorithm` text,`root_key_id` text,PRIMARY KEY (`id`));
CREATE TABLE `credentials` (`id` integer,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`identity_id` integer,`password_hash` blob,`one_time_password` numeric,PRIMARY KEY (`id`));
CREATE TABLE `organizations` (`id` integer,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`name` text,`created_by` integer,PRIMARY KEY (`id`));
CREATE TABLE `identities_organizations` (`organization_id` integer,`identity_id` integer,PRIMARY KEY (`organization_id`,`identity_id`),CONSTRAINT `fk_identities_organizations_organization` FOREIGN KEY (`organization_id`) REFERENCES `organizations`(`id`),CONSTRAINT `fk_identities_organizations_identity` FOREIGN KEY (`identity_id`) REFERENCES `identities`(`id`));
CREATE TABLE migrations (id VARCHAR(255) PRIMARY KEY);
INSERT INTO migrations VALUES('SCHEMA_INIT');
INSERT INTO migrations VALUES('202203231621');
INSERT INTO migrations VALUES('202203241643');
INSERT INTO migrations VALUES('202203301642');
INSERT INTO migrations VALUES('202203301652');
INSERT INTO migrations VALUES('202203301643');
INSERT INTO migrations VALUES('202203301645');
INSERT INTO migrations VALUES('202203301646');
INSERT INTO migrations VALUES('202203301647');
INSERT INTO migrations VALUES('202203301648');
INSERT INTO migrations VALUES('202204061643');
INSERT INTO migrations VALUES('202204111503');
INSERT INTO migrations VALUES('202204181613');
INSERT INTO migrations VALUES('202204211705');
INSERT INTO migrations VALUES('202204281130');
INSERT INTO migrations VALUES('202204291613');
INSERT INTO migrations VALUES('202206081027');
INSERT INTO migrations VALUES('202206151027');
INSERT INTO migrations VALUES('202206161733');
INSERT INTO migrations VALUES('202206281027');
INSERT INTO migrations VALUES('202207041724');
INSERT INTO migrations VALUES('202207081217');
CREATE UNIQUE INDEX `idx_identities_name` ON `identities`(`name`) WHERE deleted_at is NULL;
CREATE UNIQUE INDEX `idx_providers_name` ON `providers`(`name`) WHERE deleted_at is NULL;
CREATE UNIQUE INDEX `idx_groups_name` ON `groups`(`name`) WHERE deleted_at is NULL;
CREATE UNIQUE INDEX `idx_grant_srp` ON `grants`(`subject`,`privilege`,`resource`) WHERE deleted_at is NULL;
CREATE UNIQUE INDEX `idx_destinations_unique_id` ON `destinations`(`unique_id`) WHERE deleted_at is NULL;
CREATE UNIQUE INDEX `idx_access_keys_name` ON `access_keys`(`name`) WHERE deleted_at is NULL;
CREATE UNIQUE INDEX `idx_access_keys_key_id` ON `access_keys`(`key_id`) WHERE deleted_at is NULL;
CREATE UNIQUE INDEX `idx_encryption_keys_key_id` ON `encryption_keys`(`key_id`);
CREATE UNIQUE INDEX `idx_credentials_identity_id` ON `credentials`(`identity_id`) WHERE deleted_at is NULL;
CREATE UNIQUE INDEX `idx_organizations_name` ON `organizations`(`name`) WHERE deleted_at is NULL;
COMMIT;