# Infra

Fast, secure team access for Kubernetes.

![infra](https://user-images.githubusercontent.com/251292/105530843-64cea680-5cb6-11eb-9d97-e3210ef79914.png)

* Website: https://infrahq.com
* Docs: https://infrahq.com/docs
* Slack: https://infra-slack.slack.com

> We take security very seriously. If you have found a security vulnerability please disclose it privately to us by email via [security@infrahq.com](mailto:security@infrahq.com)

## Introduction

Infra is a tool for providing centralized access to any Kubernetes cluster for any user.

Use cases:
* On-boarding and off-boarding users
* Mapping existing users & groups (in GSuite, Okta, etc) into Kubernetes groups
* Multi-cloud cluster access
* Access Kubernetes API from CI/CD environments
* Access Kubernetes API from internal or third party tools

Features:
* Single binary
* Add & remove users
* CLI for cluster access

Coming Soon:
* UI
* Support for GSuite, GitHub, Okta, Microsoft AD identity providers
* Synchronize groups from identity providers
* Multiple clusters
* Configuration via yaml
* Enforce RBAC rules across clusters
* Dynamic cluster discovery
* Tunneling for cross-network access
* Support for Postgresql storage back-end
* Audit log
* Multi-namespace and multi-cluster queries

Supported infrastructure:
* Kubernetes clusters
* (Coming soon) Docker 
* (Coming soon) SSH
* (Coming soon) Databases
* (Coming soon) APIs


## Installing

**Installation options:**
* Kubernetes
* Docker (Coming soon)
* Linux server (Coming soon)

### Kubernetes

Install Infra via `kubectl`:

```
$ kubectl apply -f https://raw.githubusercontent.com/infrahq/infra/master/kubernetes/infra.yaml

serviceaccount created...
persistentvolume created...
persistentvolumeclaim created...
configmap created...
service created...
deployment created...
```

Then find the service on which Infra is listening:

```
$ kubectl get svc -n infra
NAME             TYPE           CLUSTER-IP     EXTERNAL-IP     PORT(S)        AGE
infra-service    LoadBalancer   10.12.11.116   32.71.121.168   80:32322/TCP   1m
```

Finally, get the admin password generated by Infra:

```
$ kubectl get secret | grep password | base64
lasd292k92d192k129d1
```


## Using Infra

### Installing the CLI

* [Download](https://infrahq.com/download) the CLI for your platform

* Move it to your `/usr/local/bin`:

```
$ mv ~/Downloads/infra /usr/local/bin/infra && chmod +x /usr/local/bin/infra
$ infra
...
```

### Logging in

Run `infra login` to log into the infra server via the CLI using the password from the previous step:

```
$ infra login 32.71.121.168
username: admin
password: ****************

✓ Logged in as admin
```

### Adding users

By default, infra only has the admin user:

```
$ infra users
USER             CLUSTER           ROLES
admin            default           cluster-admin
```

To add a user, run:

```
$ infra user add test@acme.com

User added, one-time token: m012ofj01281d2kla9

This password must be changed by the user on first login.
```

And then let's give this user "view" permission on the cluster:

```
$ infra grant test@acme.com view

✓ User test@acme.com granted role "view"
```

You can now view this updated user and role:

```
$ infra users
USER             CLUSTER           ROLES
admin            default           admin
test@acme.com    default           view
```

Now, let's log in as this new user:

```
$ infra login 32.71.121.168
username: test@acme.com
password: **************
new password: ***************

✓ Logged in as test@acme.com
```

Infra automatically updates your local kubeconfig. To access the cluster as this user:

```
$ kubectl get pods --namespace default
No pods
```

Okay, that works. Let's try creating a pod:

```
$ kubectl run nginx --image nginx
Access denied.
```

Great. Infra has blocked the user based on the "view" role we provided.

## Advanced

### Accessing the UI

Infra's dashboard is always available at `https://<infra hostname>/dashboard`

To view the ui, run `infra ui`. You'll automatically be logged if you're logged in on the CLI. Otherwise you'll be greeted with a login screen.

![Screen Shot 2021-01-22 at 2 40 10 PM](https://user-images.githubusercontent.com/251292/105537327-c1828f00-5cbf-11eb-9e8a-00b96678a121.png)

### Adding Groups

### Configuring Infra via YAML

### Configuring roles

### Adding additional Kubernetes clusters

### Auditing access

```
$ infra events
USER                 ACTION           KIND            RESOURCE                    ALLOWED     AGE   
test@acme.com        LIST             POD                                         Y           1m
test@acme.com        GET              POD             infra-a0k29dk1-102dk12      Y           1m
test@acme.com        DELETE           POD             infra-a0k29dk1-102dk12      N           1m
```

