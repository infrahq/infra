********************************************************************************

                                Welcome to Infra

  Login to this cluster with infra-cli: https://github.com/infrahq/infra#install-infra-cli

{{- if .Values.server.ingress.enabled }}
{{- with first .Values.server.ingress.hosts }}

    $ INFRA_SERVER={{ . }}
{{- end }}
{{- else if eq .Values.server.service.type "NodePort" }}

    $ NODE_HOST=$(kubectl -n {{ .Release.Namespace }} get nodes -o jsonpath="{.status.addresses[0].address}")
    $ NODE_PORT=$(kubectl -n {{ .Release.Namespace }} get services/{{ include "infra.server.fullname" . }} -o jsonpath="{.spec.ports[0].nodePort}")
    $ INFRA_SERVER=$NODE_HOST:$NODE_PORT
{{- else if eq .Values.server.service.type "LoadBalancer" }}

      NOTE: It may take a few minutes for the LoadBalancer to become available.
      You can watch the status of by running `kubectl -n {{ .Release.Namespace }} get services/{{ include "infra.server.fullname" . }} -w`

    $ INFRA_SERVER=$(kubectl -n {{ .Release.Namespace }} get services/{{ include "infra.server.fullname" . }} -o jsonpath="{.status.loadBalancer.ingress[*]['ip', 'hostname']}")
{{- else if contains .Values.server.service.type "ClusterIP" }}

    $ kubectl -n {{ .Release.Namespace }} port-forward deployments/{{ include "infra.server.fullname" . }} 8080:80 8443:443
{{- end }}

    $ infra login $INFRA_SERVER

********************************************************************************
